<div class="col-lg-12">

  @for (order of orders ; track $index) {
  @for(item of order.items;track $index ){

  <div class="item d-flex flex-column flex-md-row justify-content-between text-center text-md-start">
    <div class="d-flex gap-3 d-flex flex-column flex-md-row align-items-center">
      <div class="image mx-auto">
        <img [src]="url+item.photoPaths[0]" alt="">
      </div>
      <div class="item-info  ">
        <h5>{{item.productDisplayName}}</h5>
        <div class="d-flex flex-column flex-md-row justify-content-between">
          <p class="mb-2"># {{order.serialNumber}}</p>
          <p class="mb-2">{{'profile.date' | translate}} : {{item.dateCreated | date:"dd / MM / yyyy"}}</p>
        </div>
        <div class="d-flex flex-column flex-md-row justify-content-between column-gap-4 row-gap-2 spec">
          <!-- Not sure if it is correct ! Look => IProductOrderItem -->
          @for (att of item.attributes; track $index) {
          @if(att.attributeDisplayName.toLowerCase() == 'condition' || att.attributeDisplayName.toLowerCase() ==
          'color'){
          <p class="mb-0">{{att.attributeDisplayName}} : {{att.attributeValue}}</p>
          }
          }
        </div>
      </div>
    </div>
    <div class="d-flex flex-column justify-content-between text-center column-gap-4 row-gap-2 mt-4 mt-md-0">
      <p class="mb-0 status ">{{item.status}}</p>
      @if (item.status=='Delivered' ) {
      <button class="change-state mb-0  border-0 bg-transparent" (click)="openReview(item)">{{'profile.review' | translate}}</button>
      }@else if (item.status=='PendingPayment') {
      <button class="change-state mb-0  border-0 bg-transparent" (click)="openPaymentRequest(item)">{{'profile.requestPayment' | translate}}</button>
      }
      @if (item.status=='New' || item.status=='PendingPickup' || item.status=='PendingPayment') {
      <button class="change-state mb-0 border-0 bg-transparent" (click)="cancelOrderItem($event,item.uuid)">{{'profile.cancelOrder' | translate}}
        </button>
      }@else if (item.status=='Delivered') {
      <button class="change-state mb-0  border-0 bg-transparent"
        (click)="returnOrderItem($event,item.uuid)">{{'profile.refund' | translate}}</button>
      }
    </div>
  </div>
  }
  }
  @if (isReviewVisible && reviewItem) {

  <div class="review show test" [ngClass]="{'show':isReviewVisible}">
    <div class="modal-content">
      <div class="d-flex gap-4">
        <div class="image">
          <img [src]="url+reviewItem.photoPaths[0]" alt="">
        </div>
        <div>
          <h5>{{reviewItem.productDisplayName}}</h5>
          <p class="my-3 fa-sm ">{{'profile.date' | translate}} : {{reviewItem.dateCreated | date:"dd / MM / yyyy"}}</p>
        </div>
      </div>
      <div class="rate d-flex gap-3 mt-4">
        <h6 class="mb-0">{{'profile.rateThisProduct' | translate}}</h6>
        <div class="stars d-flex gap-1">
          @if(reviewItem.review && reviewItem.review.rate){
          @for (val of [1,2,3,4,5]; track $index) {
          @if(reviewItem.review.rate >= val){
          <i class="fa-solid fa-star fixed reviewed"></i>
          } @else {
          <i class="fa-solid fa-star reviewed"></i>
          }
          }
          }@else {
          @for (val of [1,2,3,4,5]; track $index) {
          <i StarHover class="fa-solid fa-star" (click)="onClick($event,val)"></i>
          }
          }

        </div>
      </div>
      <form [formGroup]="form" (submit)="onSubmit()">
        <div class="comment mt-4">
          <h6>{{'profile.productReview' | translate}}</h6>
          <textarea [readOnly]="reviewItem.review" formControlName="comment"
            [placeholder]="reviewItem.review ?reviewItem.review.comment:'profile.productReviewPlaceHolder' | translate"
            maxlength="1000"></textarea>
        </div>
        <div class="btns d-flex justify-content-end gap-3 mt-4 ">
          <button type="reset" class="btn btn-secondary" (click)="isReviewVisible=false">{{'profile.cancel' | translate}}</button>
          <button class="btn btn-submit" type="submit" [disabled]="reviewItem.review" [disabled]="!rate || form.invalid">{{'profile.submit' | translate}}</button>
        </div>
      </form>
    </div>
  </div>
  }


  @if (isPaymentMethodVisible) {

    <div class="review show test" [ngClass]="{'show':isPaymentMethodVisible}">
      <div class="modal-content">

      <div class="py-2 px-2 payment-method">
        <h3 class="headerOfSelectPayment mb-4">{{'cart.selectPaymentMethod' | translate}}</h3>

        <div class="form-check pb-2 ">

          <input class="form-check-input" type="radio" name="paymentMethod" id="flexRadioDefault3" [value]="'credit'"
            (change)="onPaymentMethodChange(paymentMethodEnum.CreditCard)" checked>
          <div class="d-inline-flex gap-2 me-2 align-items-center">
            <img src="assets/images/payment/MasterCard.png" alt="MasterCard">
            <img src="assets/images/payment/visa.png" alt="Visa">
            <label class="form-check-label lblOfPayment" for="flexRadioDefault3">
              {{'cart.creditCard' | translate}}
            </label>
          </div>

        </div>
        <div class="form-check pb-2">
          <input class="form-check-input" type="radio" name="paymentMethod" id="Valu" [value]="'Valu'"
            (change)="onPaymentMethodChange(paymentMethodEnum.Valu)">
          <div class="d-inline-flex gap-2 me-2 align-items-center">
            <img src="assets/images/payment/valu.jpg" alt="Valu">
            <label class="form-check-label lblOfPayment" for="Valu">
              {{'cart.valu' | translate}}
            </label>
          </div>
        </div>

        <div class="form-check pb-2">
          <input class="form-check-input" type="radio" name="paymentMethod" id="MeezaQR" [value]="'MeezaQR'"
            (change)="onPaymentMethodChange(paymentMethodEnum.MeezaQR)">
          <div class="d-inline-flex gap-2 me-2 align-items-center">
            <img src="assets/images/payment/wallet.png" alt="wallet">

            <label class="form-check-label lblOfPayment" for="MeezaQR">
              {{'cart.mobileWallet' | translate}}
            </label>
          </div>
        </div>

        <div class="form-check pb-2">
          <input class="form-check-input" type="radio" name="paymentMethod" id="Aman" [value]="'Aman'"
            (change)="onPaymentMethodChange(paymentMethodEnum.Aman)">
          <div class="d-inline-flex gap-2 me-2 aman align-items-center">
            <img src="assets/images/payment/aman.jpg" alt="Aman">
            <label class="form-check-label lblOfPayment" for="Aman">
              {{'cart.aman' | translate}}
            </label>
          </div>
        </div>


        <div class="form-check pb-2">
          <input class="form-check-input" type="radio" name="paymentMethod" id="Forsa" [value]="'Forsa'"
            (change)="onPaymentMethodChange(paymentMethodEnum.Forsa)">
          <div class="d-inline-flex gap-2 me-2 forsa align-items-center">
            <img src="assets/images/payment/forsa.png" alt="Forsa">
            <label class="form-check-label lblOfPayment" for="Forsa">
              {{'cart.forsa' | translate}}
            </label>
          </div>
        </div>

        @if(isPaymentFailed){
          <div class="error">payment failed please try again</div>
          }
      </div>

          <div class="btns d-flex justify-content-end gap-3 mt-4 ">
            <button type="reset" class="btn btn-secondary" (click)="isPaymentMethodVisible=false">{{'profile.cancel' | translate}}</button>
            <button class="btn btn-submit" type="submit"  (click)="paymentRequest()" >{{'profile.submit' | translate}}</button>
          </div>

      </div>
    </div>
    }
